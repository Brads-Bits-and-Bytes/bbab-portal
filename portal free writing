<?php
/**
 * Plugin Name: BBAB Portal
 * Plugin URI: https://bradwales.com
 * Description: A custom plugin for BBAB Portal.
 * Version: 1.0
 * Requires at least: 6.0
 * Requires PHP: 8.0
 * Author: Brad Wales
 * Author URI: https://bradwales.com
 * License: GPL2
 * License URI: https://www.gnu.org/licenses/gpl-2.0.html
 * Text Domain: bbab-portal
 */

// Prevent direct file access
if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

/**
 * Runs when the plugin is activated.   
 */
function bbab_po_activate() {
    // We'll add default options here in Phase 2
}
register_activation_hook( __FILE__, 'bbab_po_activate' );

/**
 * Runs when the plugin is deactivated.
 */
function bbab_po_deactivate() {
    // Cleanup tasks would go here if needed
}
register_deactivation_hook( __FILE__, 'bbab_po_deactivate' );

/**
 * Add settings page under Portfolio
 */
function bbab_po_add_settings_page() {
    add_options_page(
        'BBAB Portal Settings', // Page title
        'BBAB Portal', // Menu title
        'manage_options', // Capability
        'bbab-portal-settings', // Menu slug
        'bbab_po_render_settings' // Function to display the page content
    );

    _action( 'admin_menu', 'bbab_po_add_settings_page' );

 /**
 * Render the settings page content.
 */
function bbab_po_render_settings() {
    // Security check
    if ( ! current_user_can( 'manage_options' ) ) {
        return;
    }
    ?>
    <div class="wrap">
        <h1><?php echo esc_html( get_admin_page_title() ); ?></h1>
        <form method="post" action="options.php">
            <?php
            settings_fields( 'bbab-portal-settings-group' );
            do_settings_sections( 'bbab-portal-settings' );
            submit_button();
            ?>
        </form>
    </div>
    <?php
}

/**
 * Register settings and fields.
 */
function bbab_po_register_settings() {
    register_setting(
        'bbab-portal-settings-group',
        'bbab_portal_settings'
    [
        'type' => 'array',
        'sanitize_callback' => 'bbab_po_sanitize_settings',
        'default' => [],
    ]
);

// Add a section
add_settings_section(
    'bbab-portal-main-section',
    'Main Settings',
    'bbab_po_main_section_callback',
    'bbab-portal-settings'
);

// Add fields to the section
add_settings_field(
    'bbab-portal-form-id',
    'Form ID',
    'bbab_po_form_id_field_callback',
    'bbab-portal-settings',
    'bbab-portal-main-section'
);

/**
 * Section description callback.
 */
function bbab_po_main_section_callback() {
    echo '<p>Configure the main settings for the BBAB Portal.</p>';
}

/**
 * Field callback for Form ID.
 */
function bbab_po_form_id_field_callback() {
    $options = get_option( 'bbab_portal_settings' );
    echo '<input type="text" name="bbab_portal_settings[form_id]" value="' . esc_attr( $options['form_id'] ) . '" class="regular-text" />';
    ?>
    <input
        type="text"       
        name="bbab_portal_settings[form_id]"       
        value="<?php echo esc_attr( $options['form_id'] ); ?>"
        class="regular-text"
    >
    <?php
}

/**
 * Sanitize settings.
 */
function bbab_po_sanitize_settings( $input ) {
    $sanitized = [];
    if ( isset( $input['form_id'] ) ) {
        $sanitized['form_id'] = sanitize_text_field( $input['form_id'] );
    }
    return $sanitized;
}

